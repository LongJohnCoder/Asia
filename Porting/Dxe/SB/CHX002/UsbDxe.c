/** @file
   ZX-E(CHX002) Asia SbDxe library functions : UsbDxe.c

   Copyright (c) 2018 Shanghai Zhaoxin Semiconductor Co., Ltd. 

**/
//**************************************************************************
//**************************************************************************
//**                                                                      **
//**  Copyright (c) 2015 - 2017 Shanghai Zhaoxin Semiconductor Co., Ltd.  **
//**                                                                      **
//**************************************************************************
//**************************************************************************

#include "EfiCommon.h"
#include "AsiaSbDxe.h"
#include "AsiaIoSaveLib.h"
#include "CHX002Cfg.h"
#include "CHX002Reg.h"
#include EFI_PROTOCOL_DEFINITION(PciHostBridgeResourceAllocation)
#include EFI_PROTOCOL_DEFINITION(PciIo)
#include "EfiDriverLib.h"
#include EFI_GUID_DEFINITION(Hob)
#include "EfiHobLib.h"

#include "EfiBootScript.h"
#include "EfiScriptLib.h"


#include "AsiaCommon.h" //define ASIA_XXX_CFG_HOB_GUID

#include "UsbDxe.h"

STATIC ASIA_IO_TABLE_6432_REV D14F0Uhci_Performance_TBL[]={
	{0x00,	0xFF,	(CHX002_D14F0UHCI|0x48),	0x60000000,	0x60000000},

	{0xFF,	0x00,	0x00,	0x00,	0x00} 

};
	  
STATIC ASIA_IO_TABLE_6432_REV D14F0Uhci_Energy_TBL[]={
 	{0xFF,  0x00,   0x00,   0x00,   0x00}
};
	  
STATIC ASIA_IO_TABLE_6432_REV D14F7Ehci_Performance_TBL[]={
	{0x00,	0xFF,	(CHX002_D14F7EHCI|0x40),	0x2,	0x2},

	{0x00,	0xFF,	(CHX002_D14F7EHCI|0x48),	0x20,	0x0},

	{0xFF,	0x00,	0x00,	0x00,	0x00} 

};
	
STATIC ASIA_IO_TABLE_6432_REV D14F7Ehci_Energy_TBL[]={
	{0x00,	0xFF,	(CHX002_D14F7EHCI|0x40),	0x2,	0x0},

	{0xFF,	0x00,	0x00,	0x00,	0x00} 

};
	

STATIC ASIA_IO_TABLE_6432_REV D16F0Uhci_Performance_TBL[]={
	{0x00,	0xFF,	(CHX002_D16F0UHCI|0x48),	0x60000000,	0x60000000},

    {0xFF,  0x00,   0x00,   0x00,   0x00}
};
	  
STATIC ASIA_IO_TABLE_6432_REV D16F0Uhci_Energy_TBL[]={
    {0xFF,  0x00,   0x00,   0x00,   0x00}
};

STATIC ASIA_IO_TABLE_6432_REV D16F1Uhci_Performance_TBL[]={
	{0x00,	0xFF,	(CHX002_D16F1UHCI|0x48),	0x60000000,	0x60000000},

	{0xFF,	0x00,	0x00,	0x00,	0x00}
};
	
STATIC ASIA_IO_TABLE_6432_REV D16F1Uhci_Energy_TBL[]={
	{0xFF,	0x00,	0x00,	0x00,	0x00}
};


STATIC ASIA_IO_TABLE_6432_REV D16F7Ehci_Performance_TBL[]={
	{0x00,	0xFF,	(CHX002_D16F7EHCI|0x40),	0x2,	0x2},

	{0x00,	0xFF,	(CHX002_D16F7EHCI|0x48),	0x20,	0x0},

	{0xFF,	0x00,	0x00,	0x00,	0x00}

};
	  
STATIC ASIA_IO_TABLE_6432_REV D16F7Ehci_Energy_TBL[]={
	{0x00,	0xFF,	(CHX002_D16F7EHCI|0x40),	0x2,	0x0},

	{0xFF,	0x00,	0x00,	0x00,	0x00}

};

  
STATIC ASIA_IO_TABLE_6432_REV D18F0Xhci_Performance_TBL[]= {
	{0x00,	0xFF,	(CHX002_XHCI|D18F0_XHCIOPTION_BITS_RX40_XHCOPTRX40),	0x01000000,	0x01000000},

	{0x00,	0xFF,	(CHX002_XHCI|D18F0_XHCIOPTIONAL_BITS_CFG_ADR),	0xFFFFF,	0x14},

	{0x00,	0xFF,	(CHX002_XHCI|D18F0_XHCIOPTIONAL_BITS_CFG_DATA),	0x40000000,	0x40000000},

	{0x00,	0xFF,	(CHX002_XHCI|D18F0_XHCIOPTIONAL_BITS_CFG_ADR),	0xFFFFF,	0x18},

	{0x00,	0xFF,	(CHX002_XHCI|D18F0_XHCIOPTIONAL_BITS_CFG_DATA),	0x1000,	0x1000},

	{0x00,	0xFF,	(CHX002_XHCI|D18F0_XHCIOPTIONAL_BITS_CFG_ADR),	0xFFFFF,	0x50},

	{0x00,	0xFF,	(CHX002_XHCI|D18F0_XHCIOPTIONAL_BITS_CFG_DATA),	0x775d3f1f,	0x775d3f1f},

	{0x00,	0xFF,	(CHX002_XHCI|D18F0_XHCIOPTIONAL_BITS_CFG_ADR),	0xFFFFF,	0x54},

	{0x00,	0xFF,	(CHX002_XHCI|D18F0_XHCIOPTIONAL_BITS_CFG_DATA),	0x7f7f07f9,	0x7f7f07f9},

	{0x00,	0xFF,	(CHX002_XHCI|D18F0_XHCIOPTIONAL_BITS_CFG_ADR),	0xFFFFF,	0x58},

	{0x00,	0xFF,	(CHX002_XHCI|D18F0_XHCIOPTIONAL_BITS_CFG_DATA),	0x5f7f7fff,	0x5f7f7fff},

	{0x00,	0xFF,	(CHX002_XHCI|D18F0_XHCIOPTIONAL_BITS_CFG_ADR),	0xFFFFF,	0x5c},

	{0x00,	0xFF,	(CHX002_XHCI|D18F0_XHCIOPTIONAL_BITS_CFG_DATA),	0xf7,	0xf7},

	{0x00,	0xFF,	(CHX002_XHCI|D18F0_XHCIOPTIONAL_BITS_CFG_ADR),	0xFFFFF,	0x78},

	{0x00,	0xFF,	(CHX002_XHCI|D18F0_XHCIOPTIONAL_BITS_CFG_DATA),	0xffff00,	0xffff00},

	{0x00,	0xFF,	(CHX002_XHCI|D18F0_XHCIOPTIONAL_BITS_CFG_ADR),	0xFFFFF,	0x7c},

	{0x00,	0xFF,	(CHX002_XHCI|D18F0_XHCIOPTIONAL_BITS_CFG_DATA),	0x70f0000,	0x70f0000},

	{0x00,	0xFF,	(CHX002_XHCI|D18F0_XHCIOPTIONAL_BITS_CFG_ADR),	0xFFFFF,	0x10c},

	{0x00,	0xFF,	(CHX002_XHCI|D18F0_XHCIOPTIONAL_BITS_CFG_DATA),	0x3ff,	0x0},

	{0x00,	0xFF,	(CHX002_XHCI|D18F0_XHCIOPTIONAL_BITS_CFG_ADR),	0xFFFFF,	0x13c},

	{0x00,	0xFF,	(CHX002_XHCI|D18F0_XHCIOPTIONAL_BITS_CFG_DATA),	0xf0000,	0xf0000},

	{0x00,	0xFF,	(CHX002_XHCI|D18F0_XHCIOPTIONAL_BITS_CFG_ADR),	0xFFFFF,	0x10000},

	{0x00,	0xFF,	(CHX002_XHCI|D18F0_XHCIOPTIONAL_BITS_CFG_DATA),	0x2,	0x2},

	{0x00,	0xFF,	(CHX002_XHCI|D18F0_XHCIOPTIONAL_BITS_CFG_ADR),	0xFFFFF,	0x20088},

	{0x00,	0xFF,	(CHX002_XHCI|D18F0_XHCIOPTIONAL_BITS_CFG_DATA),	0x4000000,	0x4000000},

	{0x00,	0xFF,	(CHX002_XHCI|D18F0_XHCIOPTIONAL_BITS_CFG_ADR),	0xFFFFF,	0x2008c},

	{0x00,	0xFF,	(CHX002_XHCI|D18F0_XHCIOPTIONAL_BITS_CFG_DATA),	0x10000,	0x10000},

	{0x00,	0xFF,	(CHX002_XHCI|D18F0_XHCIOPTIONAL_BITS_CFG_ADR),		0xFFFFF,	0x20100},

	{0x00,	0xFF,	(CHX002_XHCI|D18F0_XHCIOPTIONAL_BITS_CFG_DATA),	0x7fff0000,	0x7fff0000},

	{0x00,	0xFF,	(CHX002_XHCI|D18F0_XHCIOPTIONAL_BITS_CFG_ADR),		0xFFFFF,	0x20200},

	{0x00,	0xFF,	(CHX002_XHCI|D18F0_XHCIOPTIONAL_BITS_CFG_DATA),	0x7fff0000,	0x7fff0000},

	{0x00,	0xFF,	(CHX002_XHCI|D18F0_XHCIOPTIONAL_BITS_CFG_ADR),		0xFFFFF,	0x20114},

	{0x00,	0xFF,	(CHX002_XHCI|D18F0_XHCIOPTIONAL_BITS_CFG_DATA),	0x70000,	0x70000},

	{0x00,	0xFF,	(CHX002_XHCI|D18F0_XHCIOPTIONAL_BITS_CFG_ADR),		0xFFFFF,	0x20214},

	{0x00,	0xFF,	(CHX002_XHCI|D18F0_XHCIOPTIONAL_BITS_CFG_DATA),	0x70000,	0x70000},

	{0x00,	0xFF,	(CHX002_XHCI|D18F0_XHCIOPTIONAL_BITS_CFG_ADR),		0xFFFFF,	0x20118},

	{0x00,	0xFF,	(CHX002_XHCI|D18F0_XHCIOPTIONAL_BITS_CFG_DATA),	0x6,	0x6},

	{0x00,	0xFF,	(CHX002_XHCI|D18F0_XHCIOPTIONAL_BITS_CFG_ADR),		0xFFFFF,	0x20218},

	{0x00,	0xFF,	(CHX002_XHCI|D18F0_XHCIOPTIONAL_BITS_CFG_DATA),	0x6,	0x6},

	{0x00,	0xFF,	(CHX002_XHCI|D18F0_XHCIOPTIONAL_BITS_CFG_ADR),		0xFFFFF,	0x20180},

	{0x00,	0xFF,	(CHX002_XHCI|D18F0_XHCIOPTIONAL_BITS_CFG_DATA),	0x6400200,	0x6400200},

	{0x00,	0xFF,	(CHX002_XHCI|D18F0_XHCIOPTIONAL_BITS_CFG_ADR),		0xFFFFF,	0x20280},

	{0x00,	0xFF,	(CHX002_XHCI|D18F0_XHCIOPTIONAL_BITS_CFG_DATA),	0x6400200,	0x6400200},

	{0x00,	0xFF,	(CHX002_XHCI|D18F0_XHCIOPTIONAL_BITS_CFG_ADR),		0xFFFFF,	0x201b0},

	{0x00,	0xFF,	(CHX002_XHCI|D18F0_XHCIOPTIONAL_BITS_CFG_DATA),	0x1000,	0x1000},

	{0x00,	0xFF,	(CHX002_XHCI|D18F0_XHCIOPTIONAL_BITS_CFG_ADR),		0xFFFFF,	0x202b0},

	{0x00,	0xFF,	(CHX002_XHCI|D18F0_XHCIOPTIONAL_BITS_CFG_DATA),	0x1000,	0x1000},

	{0x00,	0xFF,	(CHX002_XHCI|D18F0_XHCIOPTION_BITS_RX40_XHCOPTRX40),	0x01000000,	0x00000000},

	{0xFF,	0x00,	0x00,	0x00,	0x00} 
};

STATIC ASIA_IO_TABLE_6432_REV D18F0Xhci_Energy_TBL[]= {
	{0x00,	0xFF,	(CHX002_XHCI|D18F0_XHCIOPTION_BITS_RX40_XHCOPTRX40),	0x01000000,	0x01000000},

	{0x00,	0xFF,	(CHX002_XHCI|D18F0_XHCIOPTIONAL_BITS_CFG_ADR),		0xFFFFF,	0x20184},

	{0x00,	0xFF,	(CHX002_XHCI|D18F0_XHCIOPTIONAL_BITS_CFG_DATA),	0x200,	0x200},

	{0x00,	0xFF,	(CHX002_XHCI|D18F0_XHCIOPTIONAL_BITS_CFG_ADR),		0xFFFFF,	0x20284},

	{0x00,	0xFF,	(CHX002_XHCI|D18F0_XHCIOPTIONAL_BITS_CFG_DATA),	0x200,	0x200},

	{0x00,	0xFF,	(CHX002_XHCI|D18F0_XHCIOPTIONAL_BITS_CFG_ADR),		0xFFFFF,	0x201b0},

	{0x00,	0xFF,	(CHX002_XHCI|D18F0_XHCIOPTIONAL_BITS_CFG_DATA),	0x8000,	0x8000},

	{0x00,	0xFF,	(CHX002_XHCI|D18F0_XHCIOPTIONAL_BITS_CFG_ADR),		0xFFFFF,	0x202b0},

	{0x00,	0xFF,	(CHX002_XHCI|D18F0_XHCIOPTIONAL_BITS_CFG_DATA),	0x8000,	0x8000},

	{0x00,	0xFF,	(CHX002_XHCI|D18F0_XHCIOPTION_BITS_RX40_XHCOPTRX40),	0x01000000,	0x00000000},

	{0xFF,	0x00,	0x00,	0x00,	0x00} 
};

/**
  Function description.
  
  @param  PeiServices	EFI_PEI_SERVICES pointer.
  @param SbCfg Point to ASIA_SB_CONFIGURATION struct.

  @return EFI_STATUS.

**/
EFI_STATUS
EFIAPI
UsbSpeInit(
	IN UINT8	XhciSpe,
	IN UINT8	EhciSpe,
	IN UINT8	UhciSpe
)
{
	if(UhciSpe >= DEVICE_SPE_VALUE_PERFORMANCE){
		PROCESS_SB_R6432M_TABLE_SAVE(D16F0Uhci_Performance_TBL, sizeof(D16F0Uhci_Performance_TBL)/sizeof(ASIA_IO_TABLE_6432_REV));
		PROCESS_SB_R6432M_TABLE_SAVE(D16F1Uhci_Performance_TBL, sizeof(D16F1Uhci_Performance_TBL)/sizeof(ASIA_IO_TABLE_6432_REV));
		PROCESS_SB_R6432M_TABLE_SAVE(D14F0Uhci_Performance_TBL, sizeof(D14F0Uhci_Performance_TBL)/sizeof(ASIA_IO_TABLE_6432_REV));
		if(UhciSpe == DEVICE_SPE_VALUE_ENERGY){  
			PROCESS_SB_R6432M_TABLE_SAVE(D16F0Uhci_Energy_TBL, sizeof(D16F0Uhci_Energy_TBL)/sizeof(ASIA_IO_TABLE_6432_REV));
			PROCESS_SB_R6432M_TABLE_SAVE(D16F1Uhci_Energy_TBL, sizeof(D16F1Uhci_Energy_TBL)/sizeof(ASIA_IO_TABLE_6432_REV));
			PROCESS_SB_R6432M_TABLE_SAVE(D14F0Uhci_Energy_TBL, sizeof(D14F0Uhci_Energy_TBL)/sizeof(ASIA_IO_TABLE_6432_REV));
		}
	}

	if(EhciSpe >= DEVICE_SPE_VALUE_PERFORMANCE){
		PROCESS_SB_R6432M_TABLE_SAVE(D16F7Ehci_Performance_TBL, sizeof(D16F7Ehci_Performance_TBL)/sizeof(ASIA_IO_TABLE_6432_REV));
		PROCESS_SB_R6432M_TABLE_SAVE(D14F7Ehci_Performance_TBL, sizeof(D14F7Ehci_Performance_TBL)/sizeof(ASIA_IO_TABLE_6432_REV));
		if(EhciSpe == DEVICE_SPE_VALUE_ENERGY) {
			PROCESS_SB_R6432M_TABLE_SAVE(D16F7Ehci_Energy_TBL, sizeof(D16F7Ehci_Energy_TBL)/sizeof(ASIA_IO_TABLE_6432_REV));
			PROCESS_SB_R6432M_TABLE_SAVE(D14F7Ehci_Energy_TBL, sizeof(D14F7Ehci_Energy_TBL)/sizeof(ASIA_IO_TABLE_6432_REV));
		}
	}

	if(XhciSpe >= DEVICE_SPE_VALUE_PERFORMANCE) {
		PROCESS_SB_R6432M_TABLE_SAVE(D18F0Xhci_Performance_TBL, sizeof(D18F0Xhci_Performance_TBL)/sizeof(ASIA_IO_TABLE_6432_REV));
		if(XhciSpe == DEVICE_SPE_VALUE_ENERGY) {
			PROCESS_SB_R6432M_TABLE_SAVE(D18F0Xhci_Energy_TBL, sizeof(D18F0Xhci_Energy_TBL)/sizeof(ASIA_IO_TABLE_6432_REV));
		}
	}
	return EFI_SUCCESS;
}

/**
  Function description.
  
  @param  PeiServices	EFI_PEI_SERVICES pointer.
  @param SbCfg Point to ASIA_SB_CONFIGURATION struct.

  @return EFI_STATUS.

**/
EFI_STATUS
EFIAPI
UsbDxeInit(
ASIA_SB_CONFIGURATION* SbCfg 
)
{
	UINT8 XhciSpe; 
	UINT8 EhciSpe; 
	UINT8 UhciSpe; 

	switch(SbCfg->SBSPEValue)
	{
		case CHIP_SPE_VALUE_MANUAL:
			XhciSpe = SbCfg->SOCXHCISPEValue; 
			EhciSpe = SbCfg->SOCEHCISPEValue; 
			UhciSpe = SbCfg->SOCUHCISPEValue; 
			break;
		case CHIP_SPE_VALUE_STABLE:
			XhciSpe = DEVICE_SPE_VALUE_STABLE; 
			EhciSpe = DEVICE_SPE_VALUE_STABLE; 
			UhciSpe = DEVICE_SPE_VALUE_STABLE;
			break;
		case CHIP_SPE_VALUE_PERFORMANCE:
			XhciSpe = DEVICE_SPE_VALUE_PERFORMANCE;
			EhciSpe = DEVICE_SPE_VALUE_PERFORMANCE;
			UhciSpe = DEVICE_SPE_VALUE_PERFORMANCE;
			break;
		case CHIP_SPE_VALUE_ENERGY:
			XhciSpe = DEVICE_SPE_VALUE_ENERGY;
			EhciSpe = DEVICE_SPE_VALUE_ENERGY;
			UhciSpe = DEVICE_SPE_VALUE_ENERGY;
			break;
		default:
			XhciSpe = DEVICE_SPE_VALUE_STABLE;
			EhciSpe = DEVICE_SPE_VALUE_STABLE;
			UhciSpe = DEVICE_SPE_VALUE_STABLE;
			break;
	}

	UsbSpeInit(XhciSpe,EhciSpe,UhciSpe);

	return EFI_SUCCESS;
}

#ifdef ZX_DUALSOCKET

/**
  Function description.
  
  @param  PeiServices	EFI_PEI_SERVICES pointer.
  @param SbCfg Point to ASIA_SB_CONFIGURATION struct.

  @return EFI_STATUS.

**/
EFI_STATUS
EFIAPI
UsbSpeInitSlave(
	  IN UINT8	 XhciSpe,
	  IN UINT8	 EhciSpe,
	  IN UINT8	 UhciSpe
)
{
	if(UhciSpe >= DEVICE_SPE_VALUE_PERFORMANCE){
		PROCESS_SB_R6432M_TABLE_SAVE_SLAVE(SLAVE_SK_BUS_NUM, D16F0Uhci_Performance_TBL, sizeof(D16F0Uhci_Performance_TBL)/sizeof(ASIA_IO_TABLE_6432_REV));
		PROCESS_SB_R6432M_TABLE_SAVE_SLAVE(SLAVE_SK_BUS_NUM, D16F1Uhci_Performance_TBL, sizeof(D16F1Uhci_Performance_TBL)/sizeof(ASIA_IO_TABLE_6432_REV));
		PROCESS_SB_R6432M_TABLE_SAVE_SLAVE(SLAVE_SK_BUS_NUM, D14F0Uhci_Performance_TBL, sizeof(D14F0Uhci_Performance_TBL)/sizeof(ASIA_IO_TABLE_6432_REV));
		if(UhciSpe == DEVICE_SPE_VALUE_ENERGY){  
			PROCESS_SB_R6432M_TABLE_SAVE_SLAVE(SLAVE_SK_BUS_NUM, D16F0Uhci_Energy_TBL, sizeof(D16F0Uhci_Energy_TBL)/sizeof(ASIA_IO_TABLE_6432_REV));
			PROCESS_SB_R6432M_TABLE_SAVE_SLAVE(SLAVE_SK_BUS_NUM, D16F1Uhci_Energy_TBL, sizeof(D16F1Uhci_Energy_TBL)/sizeof(ASIA_IO_TABLE_6432_REV));
			PROCESS_SB_R6432M_TABLE_SAVE_SLAVE(SLAVE_SK_BUS_NUM, D14F0Uhci_Energy_TBL, sizeof(D14F0Uhci_Energy_TBL)/sizeof(ASIA_IO_TABLE_6432_REV));
		}
	}

	if(EhciSpe >= DEVICE_SPE_VALUE_PERFORMANCE){
		PROCESS_SB_R6432M_TABLE_SAVE_SLAVE(SLAVE_SK_BUS_NUM, D16F7Ehci_Performance_TBL, sizeof(D16F7Ehci_Performance_TBL)/sizeof(ASIA_IO_TABLE_6432_REV));
		PROCESS_SB_R6432M_TABLE_SAVE_SLAVE(SLAVE_SK_BUS_NUM, D14F7Ehci_Performance_TBL, sizeof(D14F7Ehci_Performance_TBL)/sizeof(ASIA_IO_TABLE_6432_REV));
		if(EhciSpe == DEVICE_SPE_VALUE_ENERGY) {
			PROCESS_SB_R6432M_TABLE_SAVE_SLAVE(SLAVE_SK_BUS_NUM, D16F7Ehci_Energy_TBL, sizeof(D16F7Ehci_Energy_TBL)/sizeof(ASIA_IO_TABLE_6432_REV));
			PROCESS_SB_R6432M_TABLE_SAVE_SLAVE(SLAVE_SK_BUS_NUM, D14F7Ehci_Energy_TBL, sizeof(D14F7Ehci_Energy_TBL)/sizeof(ASIA_IO_TABLE_6432_REV));
		}
	}

	if(XhciSpe >= DEVICE_SPE_VALUE_PERFORMANCE) {
		PROCESS_SB_R6432M_TABLE_SAVE_SLAVE(SLAVE_SK_BUS_NUM, D18F0Xhci_Performance_TBL, sizeof(D18F0Xhci_Performance_TBL)/sizeof(ASIA_IO_TABLE_6432_REV));
		if(XhciSpe == DEVICE_SPE_VALUE_ENERGY) {
			PROCESS_SB_R6432M_TABLE_SAVE_SLAVE(SLAVE_SK_BUS_NUM, D18F0Xhci_Energy_TBL, sizeof(D18F0Xhci_Energy_TBL)/sizeof(ASIA_IO_TABLE_6432_REV));
		}
	}
	return EFI_SUCCESS;
}

/**
  Function description.
  
  @param  PeiServices	EFI_PEI_SERVICES pointer.
  @param SbCfg Point to ASIA_SB_CONFIGURATION struct.

  @return EFI_STATUS.

**/
EFI_STATUS
EFIAPI
UsbDxeInitSlave(
	ASIA_SB_CONFIGURATION* SbCfg 
)
{
	UINT8 XhciSpe; 
	UINT8 EhciSpe; 
	UINT8 UhciSpe; 

	switch(SbCfg->SBSPEValue)
	{
		case CHIP_SPE_VALUE_MANUAL:
			XhciSpe = SbCfg->SOCXHCISPEValue; 
			EhciSpe = SbCfg->SOCEHCISPEValue; 
			UhciSpe = SbCfg->SOCUHCISPEValue; 
			break;
		case CHIP_SPE_VALUE_STABLE:
			XhciSpe = DEVICE_SPE_VALUE_STABLE; 
			EhciSpe = DEVICE_SPE_VALUE_STABLE; 
			UhciSpe = DEVICE_SPE_VALUE_STABLE;
			break;
		case CHIP_SPE_VALUE_PERFORMANCE:
			XhciSpe = DEVICE_SPE_VALUE_PERFORMANCE;
			EhciSpe = DEVICE_SPE_VALUE_PERFORMANCE;
			UhciSpe = DEVICE_SPE_VALUE_PERFORMANCE;
			break;
		case CHIP_SPE_VALUE_ENERGY:
			XhciSpe = DEVICE_SPE_VALUE_ENERGY;
			EhciSpe = DEVICE_SPE_VALUE_ENERGY;
			UhciSpe = DEVICE_SPE_VALUE_ENERGY;
			break;
		default:
			XhciSpe = DEVICE_SPE_VALUE_STABLE;
			EhciSpe = DEVICE_SPE_VALUE_STABLE;
			UhciSpe = DEVICE_SPE_VALUE_STABLE;
			break;
	}

	UsbSpeInitSlave(XhciSpe,EhciSpe,UhciSpe);

	return EFI_SUCCESS;
}
#endif

/**
  Function description.
  
  @param  PeiServices	EFI_PEI_SERVICES pointer.
  @param SbCfg Point to ASIA_SB_CONFIGURATION struct.

  @return EFI_STATUS.

**/
EFI_STATUS
EFIAPI
UsbInitDxe (
	ASIA_SB_CONFIGURATION   *SbCfg
)
{
    DEBUG((EFI_D_ERROR, "[USB-DXE]: USB DXE Init Start...\n"));
    UsbDxeInit(SbCfg);

#ifdef ZX_DUALSOCKET
    if(SbCfg->ZxeDualSocket == 1) {
        DEBUG((EFI_D_ERROR, "[USB-DXE]: Slave USB DXE Init Start...\n"));
        UsbDxeInitSlave(SbCfg);
    }
#endif

    DEBUG((EFI_D_ERROR, "[USB-DXE]: USB DXE Init End\n"));
    return EFI_SUCCESS;
}